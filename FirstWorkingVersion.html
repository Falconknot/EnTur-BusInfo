<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <header>
      <h1>Bus Display</h1>
    </header>
  
    <main>
      <div class="controls">
        <label for="bus-amount">Number of Buses:</label>
        <select id="bus-amount">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
        <button id="filter-btn">Filter</button>
      </div>
  
      <table id="bus-info">
        <thead>
          <tr>
            <th>Expected Departure Time</th>
            <th>Destination</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </main>
  </body>
  <style>
    * {
      box-sizing: border-box;
    }
  
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
  
    header {
      background-color: #333;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
  
    main {
      margin: 20px;
    }
  
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
  
    table {
      border-collapse: collapse;
      width: 100%;
    }
  
    th,
    td {
      border: 1px solid #333;
      padding: 8px;
      text-align: left;
    }
  
    th {
      background-color: #333;
      color: #fff;
    }
  </style>
<script>
    const query = `{
  stopPlace(id: "NSR:StopPlace:4977") {
    name
    id
    estimatedCalls(numberOfDepartures: 10, whiteListedModes: [bus]) {
      expectedDepartureTime
      aimedDepartureTime
      destinationDisplay {
        frontText
      }
      serviceJourney {
        line {
          publicCode
          transportMode
        }
      }
    }
  }
}`;

const busAmountSelect = document.querySelector('#bus-amount');
const filterBtn = document.querySelector('#filter-btn');
const busInfo = document.querySelector('#bus-info');

filterBtn.addEventListener('click', async () => {
  const selectedAmount = busAmountSelect.value;
  const response = await fetch('https://api.entur.io/journey-planner/v2/graphql', {
    method: 'POST',
    headers: {
      'ET-Client-Name': 'awesomecompany-awesomeapp',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ query })
  });
  const data = await response.json();
  const busStop = data.data.stopPlace;
  const estimatedCalls = busStop.estimatedCalls;
  let tableData = '';
  for (let i = 0; i < selectedAmount; i++) {
    const expectedDeparture = new Date(estimatedCalls[i].expectedDepartureTime);
    const expectedDepartureTime = expectedDeparture.toLocaleTimeString();
    const busNumber = estimatedCalls[i].serviceJourney.line.publicCode;
    tableData += `
      <tr>
        <td>${expectedDepartureTime}</td>
        <td>${estimatedCalls[i].destinationDisplay.frontText}</td>
        <td>(${busNumber})</td>
      </tr>
    `;
  }
  busInfo.innerHTML = tableData;
});

</script>    